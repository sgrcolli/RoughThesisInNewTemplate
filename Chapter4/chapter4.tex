%*******************************************************************************
%****************************** Fourth Chapter *********************************
%*******************************************************************************


\chapter{Detector Component Simulation}\label{chp:GEANT4Simulation}
\ifpdf
    \graphicspath{{Chapter4/Figs/Raster/}{Chapter4/Figs/PDF/}{Chapter4/Figs/}}
\else
    \graphicspath{{Chapter4/Figs/Vector/}{Chapter4/Figs/}}
\fi

This chapter will focus on simulating each individual component of the upgraded detector in GEANT4 \cite{Agostinelli:2002hh}. After a brief over view of GEANT4 the Birks' law and parameterising/approximating the light output is covered. The Birks' constant used by MINER$\nu$A is used as reference as it uses the same scintillator as the VIDARR detector. Then the Birks' law approximation is compared to the light output in GEANT4 for each particle using a ``slice'' model to approximate short travel distance in the detector and a ``slab'' model to test that light approximation. Then test stand data is used to model a single bar to create data-driven representations of the attenuation and dark noise. The effect of the TiO$_2$ coating is also observed as it is relevant for especially heavy particles such as protons. This is all pulled together by analysing the effects of quenching on the particles and the effects of counting statistics on the simulation by looking at alpha particles. Once the background has been modelled more realistically the trigger signal (the Gd cascade) is enhanced via a hybrid Gd model based on GEANT4's final state model and the DANCE $^{157}$Gd DICEBOX. 

\section{GEANT4 Overview}\label{sec:GEANT4Simulation_g4Overview}
The VIDARR detector is simulated using the GEANT4 toolkit, which is a prominent physics simulation package \cite{Agostinelli:2002hh}. According to the GEANT4 collaboration, GEANT4 ``covers a comprehensive range including electromagnetic, hadronic and optical processes and a large set of long-lived particles materials and elements over a wide energy range starting in some cases from 250\,eV and extending in others to the TeV range'' \cite{Agostinelli:2002hh}. Considering that the energy range for IBD reactor neutrinos is $\sim$ 1.8\,MeV -- 8.5\,MeV \cite{Mueller_2011} and cosmic muons typically range from 100\,MeV to 100\,GeV \cite{ieee_cry_2007} this simulation package meets the needs of the VIDARR collaboration. The positron and neutron from IBD (see equation \ref{inverse_beta_decay}) are simulated by GEANT4, they are in the same event but kinetic energies and directions have no relation to each other at present. Whilst the simulation of positrons is reasonably straight forward the simulation of the neutrons is significantly more complex. In the detector the neutrons are primarily captured upon $^{155,157}$Gd coated on Mylar sheets between the scintillator planes. Although GEANT4 can accurately simulate the neutron transport to the point of capture, the de-excitation of the nuclei after capture via gamma-ray emission are poorly known due to the complexity of the $\sim$ 8\,MeV gamma-ray cascades. GEANT4 provides models for the gamma-ray cascades in Gd, limiting the accuracy of simulation to the accuracy of these models.
%This is due to the gadolinium sulphate sheets that capture the neutrons and emit an 8\,MeV gamma cascade. The Gadolinium cascade is hard to model accurately due to the high energies and number of nucleons involved ($>$ 150).
% \\\\The simulation has several distinct modes: cosmic $\mu$, Dark noise, background, and inverse $\beta$ decay. The cosmic model has a realistic distribution based on the Cosmic Ray Shower Library (CRY) \cite{ieee_cry_2007} and a cosmic hemisphere distribution. The cosmic hemisphere distribution is used to determine any bias in the comic tracker which reconstructs cosmic $\mu$ events. In all other cases, the realistic cosmic distribution is used when simulating cosmic $\mu$. The background distributions are random uniform distributions from 0 -- 10\,MeV simulating which cover $p$,$\bar{p}$,$\pi^+$,$\pi^-$,$e^-$,$e^+$, $\alpha$,$\bar{\alpha}$,$n$. IBD is approximated by simulating a positron and a neutron simultaneously the positron energy is a flat distribution between 0\,MeV -- 10\,MeV the neutron takes $\sim$ 50\,$\mu$s to be absorbed (see figure \ref{fig:delayedIbdTimes}) . The range 0\,MeV -- 10\,MeV is used instead of 1.8\,MeV -- 8.5\,MeV for more robust fitting and identification of edge cases.
% \\\\An example of a simulated IBD event can be seen in figure \ref{fig:simultaedIbdEvent}, the simulation produces a $e^+$ and neutron simultaneously it does not simulate the $\bar{\nu_e}$ interaction with matter. This is not a major constraint as this is the signal that the detector measures but it does mean that the $\bar{\nu_e}$ rate is not modelled by the simulation. The times for the generated neutron to complete its random walk through the detector + the time taken for the Gadolinium sheets in-between the segments to absorb the neutron + the time taken for the cascade to occur is shown in figure \ref{fig:delayedIbdTimes}. It is possible for the neutron absorption to take up to 100 $\mu$s when simulating a kinetic energy of 10\,keV. A kinetic energy of 10\,keV is a reasonable assumption when considering the work of Vogel and Beacom \cite{Vogel_1999}. 
\\\\The simulation does not consider the interactions between neutrinos and matter, IBD events are simulated by injecting a positron and a neutron into the detector from the same vertex. As the neutron only has $\sim$ 10\,keV of energy, the kinetic energy of the positron may be determined from the energy of the anti-neutrino. The angular distribution of the positron was assumed for this study to be isotropic, as the anti-neutrino emission angle is only expected to be weakly dependent on the anti-neutrino angle \cite{Vogel_1999} and due to the detector granularity, no measure of positron direction will be possible. An example of a simulated IBD event can be seen in figure \ref{fig:simultaedIbdEvent}. As the range of the positron in the detector is only about a few cm, energy deposits across two bars are most common. Multiple hits from the subsequent gamma-ray cascade from the neutron capture on Gd are seen. The time difference between these two events is dependent on the neutron thermalisation time, the random walk of the neutron, and the Gd concentration and distribution in the detector. The time range for neutron capture is shown in fig \ref{fig:delayedIbdTimes} where 99\,\% of neutrons are captured within $50\,\mathrm{\mu}$s. The anti-neutrino interaction rate across the detector does not require GEANT 4 simulation as the presence of the detector does not change the anti-neutrino flux significantly. The interaction rate at any point of the detector may be simply calculated using the expected anti-neutrino flux and the IBD cross-section.

\begin{figure}[!h]
\centering
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/simulatedIbdG4.png}
  \captionof{figure}[Simulated inverse beta decay event of VIDARR in GEANT4.]{A simulated inverse beta decay event in GEANT4 in the upgraded VIDARR detector with 70 layers and shielding around the outside of the detector. The delayed components are shown in blue and the prompt components are shown in red. The delayed component hits more bars than the prompt component.} 
  \label{fig:simultaedIbdEvent}
  \vspace{0.478cm} %1 line = 0.478cm % 2 lines = 0.956cm % 3 lines= 1.434cm % 4 lines = 1.912cm % 5 lines = 2.39cm
\end{minipage}%
\qquad
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/neutron10KeVAbsoptionTimesMedText.png} 
  \captionof{figure}[Time taken for neutron IBD to thermalise.]{The time taken for the neutron from the simulated electron anti-neutrino inverse beta decay event to be thermalised and be absorbed by the Gadolinium sheets in the simulated VIDARR detector. Assuming a kinetic energy of 10\,keV. Over 99\,\%, of neutrons are absorbed in 50 $\mu$s, but a tail extends up to $\sim$~1000\,$\mu$s.}
  \label{fig:delayedIbdTimes}
\end{minipage}
\end{figure}

\section{Modelling Light Emission}\label{sec:GEANT4Simulation_ModellingLightEmission}
% In order to measure light for a given amount of scintillating material, we need to consider several factors. For organic scintillators, the type of particle has a significant effect on the absolute light yield. 
% The light output of organic scintillators such as the PPO/POPOP \hl{plot reference ppo/popop how they overlap} combination used in the VIDARR scintillating bars rely on the light emission of the scintillator molecules following excitation by ionising particles and the absorption and emission of the light by a fluor. 
VIDARR relies on the FNAL/NICADD\footnote{FNAL is the Fermilab National Accelerator Laboratory and NICADD is the Northern Illinois Centre for Accelerator and Detector Development.} extruded organic scintillator which is predominantly a polystyrene base mixed with 1\,\%\,wt/wt PPO + 0.03\,\%\,wt/wt POPOP which are the fluors \cite{pla2003extruding}. The base scintillator is excited by an ionising particle which leave behind it a wake of excited molecules. These excited molecules transfer their energy to the primary fluor via the ``Forster energy transfter'' which is a dipole-dipole non-radioactive transfer of energy at $\sim$~100\,{\AA} \cite{Zyla_pdg_2020}. The primary flour (PPO in VIDARR) is typically doped at $\sim$~1\,\%\,wt/wt and emits radiation at $\sim$~340\,nm (PPO's emission is $\sim$~350\,nm see figure \ref{subFig:ppoPopopEmiss}). This radiation is then absorbed by the secondary fluor, (POPOP in VIDARR). Finally the secondary fluor emits a photon at the desired blue wavelength $\sim$~400\,nm (POPOP's emission is at $\sim$~410\,nm see figure \ref{subFig:ppoPopopEmiss}). A secondary fluor is used as it allows for further wavelength shifting thus giving an emission wavelength closer to the desired value and a longer attenuation length \cite{Zyla_pdg_2020}. In addition, the absorption spectrum of the secondary flour should have significant overlap with the emission spectrum of the primary flour. In figure \ref{subFig:ppoPopopAbsorb} the absorption spectrum of POPOP can be seen to range between 300\,nm~--~400\,nm which overlaps very well with the emission spectrum of PPO seen in figure \ref{subFig:ppoPopopEmiss}. There is some reabsorption by the PPO as seen in figure \ref{subFig:ppoPopopAbsorb} the PPO also absorbs photons between 300\,nm~--~400\,nm as a result both the PPO and POPOP emission spectra are produced by the scintillator (see figure \ref{subFig:ppoPopopEmiss}). This scintillation ``ladder'' is depicted in figure \ref{fig:scintillationLadder} and shows the order of the events and rough wavelengths for a generic scintillator. The fluors wavelength shift the scintillation light so that the light is not reabsorbed by the scintillator and may be guided to an external photo-sensor (reabsorption is undesirable as it shortens the attenuation length). Further, the heavy doping of the primary fluor decreases the decay time from $\sim$~16\,ns (pure polystyrene) by order of magnitude \cite{Zyla_pdg_2020}. The concentration of scintillator and fluors in the medium limit the amount of scintillation light produced and wavelength shifted (though with diminishing returns), with high density ionisation regions producing proportionally less detectable light than low ionisation density regions leading to changing responses for ionising radiations with different ionisation densities. The response of organic scintillators to charged particles can best be described by a relation between $dL/dx$ the fluorescent energy emitted per unit path length and $dE/dx$ the specific energy loss for the charged particle. A widely used relation was first suggested by John Birks \cite{birks_1964} and is based on the assumption that a high ionisation density along the track of the particle creates ``damaged'' particles which dissipate ionisation energy non-radiatively, quenching the light output. These “damaged” molecules occupy highly ionised or excited states, they de-excite quickly $\mathcal{O}$(ns) to the “undamaged” condition \cite{knoll_2010}. Some permanent damage will occur and does contribute to long term degradation of the scintillator but this is not relevant for quenching \cite{knoll_2010}. Assuming that the density of damaged molecules along the wake of the particle is directly proportional to the ionisation density, their density may be represented by $B(dE/dx)$ where $B$ is a proportionality constant. Birks assumes that some fraction $k$ of these will lead to quenching \cite{craun_1970}. A further assumption is that in absence of quenching the light yield is proportional to energy loss shown in equation \ref{equ:light_yield_proportional}.
\begin{equation}
\frac{dL}{dx} = S\frac{dE}{dx}
\label{equ:light_yield_proportional}
\end{equation}
In equation \ref{equ:light_yield_proportional} $S$ is the scintillation efficiency \cite{birks_1964}. The light yield of a scintillator including the quenching from damaged molecules is expressed by Birks' law (equation \ref{equ:Birks_formula}), giving the light output as a function of the energy deposition per unit length, the quenching factor $kB$ and the efficiency of the scintillator $S$. $B$ is the ratio of damaged/undamaged molecules along the particle path, and $k$ is the relative probability of quenching, although these constants are not separably measurable. The value of $kB$ is constant for a given scintillator material as is known as Birks' constant. For low ionising particles, Birks' law becomes linear at low energies. For electrons the response is linear above $\sim$ 125\,keV, \cite{craun_1970}. As Birks' law (equation \ref{equ:Birks_formula}) is linear for fast electrons \cite{knoll_2010} quenching may not be sufficient for modelling fast electrons, other effects such as scattering and straggling may have more effect on the light curve as will be expanded upon in section \ref{sec:GEANT4Simulation_quenchingLoss}. 
\begin{figure}[!h]
\centering
\begin{subfigure}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/ppo_popop_absorption_graph_adjust.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:ppoPopopAbsorb}
\end{subfigure}%
\qquad
\begin{subfigure}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/ppo_popop_emission_graph_adjust.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:ppoPopopEmiss}
\end{subfigure}
\caption[Absorption and emission spectra for PPO and POPOP.]{Absorption spectra (a) and emission spectra (b) for PPO and POPOP. These are the two fluors in the scintillator used in VIDARR. The fluors absorb wavelengths between 200\,nm to 400\,nm  (see a) and emit wavelengths between 300\,nm to 500\,nm (see b). The spectra were taken from \cite{omlcPPO} \cite{omlcPOPOP} which used the photochemCAD packages \cite{du98photochemcad} \cite{dixon2005photochemcad}. }
\label{fig:ppoPopopAbsorbEmiss}
\end{figure}

\begin{figure}[!h]
  \centering
  \includegraphics[width=0.5\linewidth]{Chapter4/Figs/SmartSelect_20220902-153757_Noteshelf.jpg}
  \caption[Cartoon of scintillation ``ladder'' depicting the operating mechanism of organic scintillator.]{Cartoon of scintillation ``ladder'' depicting the operating mechanism of organic scintillator. Approximate flour concentrations and energy transfer distance from the separate subprocesses are shown from \cite{Zyla_pdg_2020}. Note for VIDARR the primary fluor concentration is 1\,\%\,wt/wt and 0.03\,\%\,wt/wt for the secondary fluor.}
  \label{fig:scintillationLadder}
\end{figure}

%the track of the particle leads to quenching from damaged molecules and a lowering of  scintillation efficiency. If we assume that the density of damaged molecules along the wake of the particle is directly proportional to the ionisation density we can represent their density by $B(dE/dx)$ where $B$ is a proportionality constant. Birks assumes that some fraction $k$ of these will lead to quenching\cite{knoll_2010}. A further assumption is that in absence of quenching the light yield is proportional to energy loss shown in equation \ref{equ:light_yield_proportional}. In equation \ref{equ:light_yield_proportional} $S$ is the normal scintillation efficiency \cite{birks_1964}. To account for the probability of quenching Birks then writes equation \ref{equ:Birks_formula}. Equation \ref{equ:Birks_formula} is commonly referred to as the Birks formula. The product $kB$ in equation \ref{equ:Birks_formula} is treated as an adjustable parameter to fit experimental data for a specific scintillator. Whereas $S$ in equation \ref{equ:Birks_formula} is particle specific and provides absolute normalisation \cite{knoll_2010}.  
\begin{equation}
\frac{dL}{dx} = \frac{S\frac{dE}{dx}}{1 + kB \frac{dE}{dx}}
\label{equ:Birks_formula}
\end{equation}

% \\\\In this model molecules in the ionisation column are labelled ``damaged'' and ``undamaged'' for convenience, this nomenclature was coined by Birks and has been used since \cite{birks_1964}, \cite{craun_1970}, \cite{knoll_2010}. ``Damaged'' molecules are those which dissipate ionisation energy non-radiatively (quenching) and so lower the scintillation efficiency\cite{craun_1970} \cite{knoll_2010}. ``Damaged'' molecules occupy highly ionised or excited states, they de-excite quickly ($<$ 1 ns) to the ``undamaged'' condition \cite{craun_1970}. Some permanent damage will occur and does contribute to long term degradation of the scintillator but this is not relevant for quenching\cite{craun_1970}. B, therefore, is the ratio of ``damaged''/``undamaged'' molecules and k is the relative probability of quenching. kB is treated as a single adjustable parameter as there is no way to measure k or B separately \cite{craun_1970} \cite{knoll_2010}. kB is scintillator dependant only and will be referred to as a single entity: Birks' constant. For electrons above $\sim$ 125\,keV the response from the scintillator is linear \cite{craun_1970}. Birks' law (equation \ref{equ:Birks_formula}) also becomes linear for fast electrons \cite{knoll_2010}. As a result, quenching may not be sufficient for modelling fast electrons as will be expanded upon in section \ref{sec:GEANT4Simulation_quenchingLoss}. 

\section{MINER$\nu$A Birks' Constant}\label{sec:GEANT4Simulation_MINERvABirksConstant}
In equation \ref{equ:Birks_formula} the parameters $kB$ and $S$ are empirically determined. $S$ is treated as particle-dependent (though physically it is not) and kB is treated as particle-independent. The MINER$\nu$A collaboration \cite{aliaga_2015} also uses the same scintillator as the VIDARR detector \cite{aliaga_2014}, and determined the value of the of $kB = 0.0905 \pm 0.015$\,mm/MeV at best fit. The MINER$\nu$A collaboration obtained this result by analysing results from the Fermilab Test Beam Facility tertiary hadron beam which produces pions (positive and negative) and protons with a usable momentum of 0.35~--~2.0\,GeV/c. This was then checked against the Bertini cascade model in GEANT4. VIDARR then performed its own internal investigation using the GEANT4 Bertini cascade model between 0~--~100\,MeV and found a Birks parameter of 0.0947\,$\pm$\,0.0001\,mm/MeV. This value is consistent with the MINER$\nu$A value. The errors on the VIDARR results are purely statistical as they are derived exclusively from simulation. The result from MINER$\nu$A is from measured data and as such contain systematic and statistical errors and therefore is used hereafter. The VIDARR investigation was solely to determine that the Bertini cascade model in GEANT4 remained consistent at lower energies than MINER$\nu$A tested. %This Birks parameter was obtained by using GEANT4 simulations, which is the same approach by which VIDARR has obtained its Birks' parameter, $kB = 0.0947 \pm 0.00001$\,mm/MeV \cite{aliaga_2015} \hl{mention statistical and systematic errors! This sounds like VIDARR did a better job which is not true!}.Both the VIDARR and MINER$\nu$A approach use the GEANT4 Bertini cascade model when determining the Birks' constant $kB$ \cite{Heikkinen_2003}. 
\\\\GEANT4 uses collections of simulated physics processes called physics lists. Each physics list has ranges and models that make them suitable under different circumstances. For VIDARR when simulating the full detector the \texttt{shielding} physics list is used for it's more accurate neutron modelling. However, for modelling and approximating GEANT4's light output the standard Quark Gluon String physics list (\texttt{QGSP}) was used. This was done as the MINER$\nu$A collaboration had used this list and it produced good results for light output \cite{Patrick_2018}. The steps have to remain large in GEANT4 otherwise the $kB$ parameter changes \cite{aliaga_2015}. This is why the \texttt{EMY} physics lists were not used, even though they simulate smaller steps and so would potentially simulate particle stopping behaviour better. Then energy range for the MINER$\nu$A signal is of order $\sim$ 1\,GeV, whereas the energy range for VIDARR's signal is $\sim$~0\,MeV -- 10\,MeV. However, a major source of background for VIDARR is $\mu$ from cosmic rays which have energies $\sim$ 1\,GeV and protons with energies between 0-10\,MeV as a result of cosmogenic fast neutrons. Using the MINER$\nu$A data requires going to higher energies (lower $dE/dx$) in order to ensure similar results in the $dL/dx$ fit.  
\\\\The results of the MINER$\nu$A Birks' law investigation concluded that a Birks' constant of $kB = 0.0905 \pm 0.015$\,mm/MeV was the most accurate value for the scintillator \cite{aliaga_2015}. Despite the different energy ranges the simulations conducted by VIDARR largely agree with MINER$\nu$A Birks' constant largely agree with the Birks' constant of MINER$\nu$A. This is because Birks' law is a representation of the scintillator itself and therefore is not particle or energy-dependent. The amount of saturation in the scintillator that Birks' constant represents is constant in all cases. The $kB$ value used in the simulation is the MINER$\nu$A value, but ultimately it makes a minimal difference as the values obtained by VIDARR and MINER$\nu$A are so similar. 
\section{Approximating GEANT4's Light Output}\label{sec:GEANT4Simulation_MonteCarloBirksLaw}
Modelling photons in GEANT4 is computationally expensive it requires simulating optical photon tracks at every energy deposition for a given amount of energy. A scintillation yield of $10^5$\,photons/MeV is considered a good approximation for a plastic scintillator as it covers the energy range of interest (0\,MeV -- 10\,MeV) and significantly above \cite{craun_1970}. But with such a high scintillation yield the slowdown observed in simulation is especially pronounced at higher energies ($\gtrapprox 5\,\textrm{MeV}$). This slowdown can be somewhat alleviated by counting the number of photons and then killing the optical photon tracks. As the number of photons determines the quenching, even the ``count and kill'' method is computationally expensive. So whilst the ``count and kill'' method was used for determining Birks' law, once the light production was characterised this method needed to be approximated with a faster approach due to its high computational load.
\\\\In order to accurately model the light output, two new simulations of the scintillator were required to quantify the effects of quenching (equation \ref{equ:Birks_formula}). Both of them required the removal of all wavelength shifting fibres and MPPCs, they are just scintillator as only the scintillator is emitting light. The first model is a ``slice model'' that is 1\,mm thick and had a cross-section of $200\,\textrm{mm} \times 200\,\textrm{mm}$ (see figure \ref{fig:lengthAndSideViewSliceElectron780Square}). This model allows for the approximations $dL/dx \approx \Delta L / \Delta x$ and $dE/dx \approx \Delta E / \Delta x$ to be used. The second model was a ``slab'' model (figure \ref{fig:electrons_viewed_in_slab}) that was $200\,\textrm{m} \times 200\,\textrm{m} \times 200\,\textrm{m}$. This model is used to determine the effect of quenching on the energy deposited in the scintillator and testing the approximation of GEANT4's light is suitable. The ``slab'' model is so large so particles cannot escape. Both models had particle energy ranges of 0\,MeV -- 100\,MeV, this was done to constrain the light fit and therefore increase accuracy. After the scintillator response has been quantified the energy ranges are changed back to 0\,MeV -- 10\,MeV. %, the energy range for most particles is 0\,MeV -- 10\,MeV.

\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/lengthOnViewSliceElectron780Square.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:lengthOnViewSliceElectron780Square}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/sideOnViewSliceElectron780Square.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:sideOnViewSliceElectron780Square}
\end{subfigure}
\caption[A 1\,MeV particle being simulated in a slice of scintillator.]{A 1\,MeV electron particle (red track) being simulated in a slice of plastic scintillator measuring $200\,mm \times 200\,mm$ in (y,z) with 1\,mm thickness in x. Optical photons (green tracks) are simulated to show how many are produced even over such a short distance at relatively low energies. (a) shows the side on view (x,z). (b) shows the length on view (y,z)}
\label{fig:lengthAndSideViewSliceElectron780Square}
\end{figure}

The ``slice'' model was used to determine the $S$ values for every particle in equation \ref{equ:Birks_formula}, once those had been obtained, the $kB$ value of 0.0905 $\pm$ 0.015\,mm/MeV obtained from MINER$\nu$A was also used \cite{aliaga_2015}. By using the approximations $dL/dx \approx \Delta L / \Delta x$ and $dE/dx \approx \Delta E / \Delta x$ and using $\Delta L = L_{\textrm{end}} - L_{\textrm{start}} $ where in the simulation it is known that the light at the start of the step $L_{\textrm{start}} = 0$ and $L_{\textrm{end}}$ is the light at the end of each GEANT4 equation \ref{equ:light_produced} can be inferred. Using equation \ref{equ:light_produced} the light yield can now be calculated for the following particles: alphas, anti-alphas, protons, anti-protons, pions, anti-pions, muons, anti-muons, electrons, and positrons.

\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.7\linewidth]{Chapter4/Figs/newSlab3d950By900Red.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:electronsSlab3d}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.7\linewidth]{Chapter4/Figs/newSlabSideOnView950By900Red.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:electronsSlabSideOn}
\end{subfigure}
\caption[One hundred generated electrons in a large slab of scintillator.]{One hundred generated electrons in a large slab of scintillator with a kinetic energy from 0\,MeV -- 100\,MeV. The slab of scintillator is $200\,m \times 200\,m \times 200\,m$. Figure \ref{subFig:electronsSlab3d} shows the 3D view of the event in the slab and figure \ref{subFig:electronsSlabSideOn} shows the zoomed in side on view of the electrons travelling down the x direction.}
\label{fig:electrons_viewed_in_slab}
\end{figure}

\begin{equation}
L_{\textrm{end}}\approx \Delta x \left(\frac{S\frac{\Delta E}{\Delta x}}{1 + kB \frac{\Delta E}{\Delta x}}\right) 
\label{equ:light_produced}
\end{equation}
\\The approximations that Birks' law predicts for alphas, anti-alphas, protons, anti-protons, pions, anti-pions, muons, and anti-muons are very close to the model of light that GEANT4 predicts. The deviation from GEANT4 is at the largest at 100\,MeV where there is a deviation of $\sim$ $3\%$ in light output between GEANT4 and the Birks approximation of protons and anti-protons seen in figure \ref{fig:proton_aproton_light} (\ref{subFig:proton_light} represents protons and \ref{subFig:aproton_light} represents anti-protons). In figure \ref{fig:proton_aproton_light}, the Birks approximation is a closer fit to the data than the simulated light fit which is a second order polynomial (equation \ref{equ:2ndOrderLightFit}):
\begin{equation}
    L = aE^2 + bE+ c 
    \label{equ:2ndOrderLightFit}
\end{equation}
A full table of $S$ values can be seen in table \ref{tab:sValueTable}. Apart from electrons and positrons most values for $S$ clustered around the expected value of 10$^5$\,photons/MeV. When averaging all particles (except electrons and positrons) an $S$ value of 9990 $\pm$ 10\,photons/MeV is achieved. This S value is considered the most accurate value for the scintillator but for each particle individual $S$ values are chosen so that each Birks approximation is as close to GEANT4's light output as possible.

\begin{table*}[!h]
\centering
\begin{tabular}{lllll}  
\toprule
Particle       & kB [mm/MeV]        & S [photons/MeV]   & Fitting Range [MeV/mm]\\ %& $\chi^2$/NDF\\
\midrule
$\alpha$       & 0.0905 $\pm$ 0.015 & 9963.5  $\pm$ 0.3 & 0 -- 200\\               %& 98.3163 \\
$\bar{\alpha}$ & ....               & 9973.1  $\pm$ 0.2 & 0 -- 200\\               %& 85.7297 \\
$P$            & ....               & 9967.5  $\pm$ 0.3 & 0 -- 200\\               %& 297.246 \\
$\bar{P}$      & ....               & 9987.1  $\pm$ 0.3 & 0 -- 200\\               %& 607.475 \\
$\pi^+$        & ....               & 9978.2  $\pm$ 0.3 & 0 -- 200\\               %& 9762.33 \\
$\pi^-$        & ....               & 9985.3  $\pm$ 0.3 & 0 -- 200\\               %& 13193.4 \\
$\mu^-$        & ....               & 10043.1 $\pm$ 0.3 & 0 -- 200\\               %& 42026.8 \\
$\mu^+$        & ....               & 10027.2 $\pm$ 0.3 & 0 -- 200\\               %& 23874.9 \\
$e^-$          & ....               & 9418    $\pm$ 2   & 2 -- 19 \\               %& 13.4511 \\
$e^+$          & ....               & 9276    $\pm$ 2   & 2 -- 19 \\               %& 26.3355 \\
\bottomrule  
\end{tabular}
\caption{The kB and S values for each particle in the simulation were found via Birks' equation. The kB value is from MINER$\nu$A and is the same for each particle. The $\chi^2$/NDF values are high due to the high number of statistics and large fluctuation in each distribution (see appendix  \ref{appendixD:dldxVsDedxPlots} for a full list of plots). This isn't concerning so long as the simulated light from GEANT4 roughly matches the Birks' approximation.}
\label{tab:sValueTable}
\end{table*}

\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/protonSimulatedLightNew.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:proton_light}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/aProtonSimulatedLightNew.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:aproton_light}
\end{subfigure}
\caption[Proton and anti-proton light output in GEANT4.]{Proton (a) and anti-proton (b) light output compared to the Birks approximation and a 2$^\textrm{nd}$ order polynomial fit to the light output in GEANT4.}
\label{fig:proton_aproton_light}
\end{figure}

However, the light yield for electrons and positrons (see figure \ref{fig:electron_positron_light}) varies more significantly. At 100\,MeV a variation of $\sim$ 15\,\% is seen in both the electron light yield (figure \ref{subFig:electron_light}) and positron light yield (figure \ref{subFig:positron_light}). The reason for this discrepancy is the low values of $dE/dx$ for electrons and positrons. Whilst the Birks' law fits well between 2\,MeV/mm -- 19\,MeV/mm, the higher energy values for electrons and positrons tend to have lower values of $dE/dx$ which the Birks' law does not fit well. The solution is to fit a second order polynomial for $dE/dx$ vs. $dL/dx$, equation \ref{equ:secondOrderDlDe}, between 0\,MeV/mm -- 2\,MeV/mm (coefficients and $\chi^2$/NDFs are seen in table \ref{tab:e-e+SquareDlDeTable}). This additional correction is used in figure \ref{fig:square_electron_positron_light} for both electrons (figure \ref{subFig:square_electron_light}) and positrons (figure \ref{subFig:square_positron_light}) and results in a much more accurate approximation of GEANT4's light yield. The reason for the large discrepancy is due to scattering and range straggling as higher energy electrons and positrons particles travel much further than the other charged particles and as such much their $dE/dx$ values tend to be lower \cite{knoll_2010}. Range straggling is insignificant for the other particles simulated. For example the straggling for protons and alpha particles amounts to a few percent of the mean range \cite{knoll_2010}. And other particles travel distance is so small they rarely scatter significantly. 
\begin{equation}
    dL/dx = a(dE/dx)^2 + b(dE/dx) + c
    \label{equ:secondOrderDlDe}
\end{equation}
% However, the light yield for electrons and positrons seen in figure \ref{fig:electron_positron_light} varies more significantly. At 100\,MeV a variation of $\sim$ 15\,\% is seen in the electrons (figure \ref{subFig:electron_light}) and a variation and a variation of $\sim$ 20\,\% is seen in positrons (figure \ref{subFig:positron_light}). In figure \ref{fig:electron_positron_light} the simulated light which is a square function more accurately represents the GEANT4 light predictions. Figure \ref{fig:square_electron_positron_light} shows this approximation inputted instead. There is a slight variation between the simulated light fit and the square approximation seen in figures \ref{subFig:square_electron_light} ($e^-$) and \ref{subFig:square_positron_light} ($e^+$). This is because the simulated light fit fits the whole light distribution whereas the light produced by the approximation in simulation is produced per GEANT4 step. Despite this, the square approximation for $e^-$ light ($L = 0.9347E^2 + 10340E - 0.1000$) had a variation of 0.7\,\% at 100\,MeV and the square approximation of the $e^+$ light ($L = 0.9716E^2 + 10350E -0.1000$) had a variation of 0.3\,\% at 100\,MeV. 
\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/electronSimulatedLightNew.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:electron_light}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/positronSimulatedLightNew.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:positron_light}
\end{subfigure}
\caption[Electron and positron light output in GEANT4.]{Electron (a), Positron (b) light output compared to the Birks approximation and a 2$^\textrm{nd}$ order polynomial fit to the light output in GEANT4}
\label{fig:electron_positron_light}
\end{figure}

\begin{table*}[!h]
\centering
\begin{tabular}{lllll}  
\toprule
Particle       & a                 & b                 & c                 \\%& $\chi^2$/NDF\\
\midrule
$e^-$          & -553.3 $\pm$ 0.7  & 9220.5 $\pm$ 0.5  & 258.10 $\pm$ 0.07 \\%& 39.9469 \\
$e^+$          & -651.1 $\pm$ 0.8  & 9266.5 $\pm$ 0.5  & 251.59 $\pm$ 0.08 \\%& 31.0016 \\
\bottomrule  
\end{tabular}
\caption[The electron and positron $dE/dx$ vs $dL/dx$ for 0\,MeV/mm -- 2\,MeV/mm]{The electron and positron $dE/dx$ vs $dL/dx$ for 0\,MeV/mm -- 2\,MeV/mm. This is described by equation \ref{equ:secondOrderDlDe}. The fit for both have high $\chi^2$/NDF which is not a concern as it improves the light approximation significantly and is partially a result of high statistics. }
\label{tab:e-e+SquareDlDeTable}
\end{table*}

\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/electronSimulatedLightBirksAndPoly2New.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:square_electron_light}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/positronSimulatedLightBirksAndPoly2New.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:square_positron_light}
\end{subfigure}
\caption[Electron and positron light approximations compared to GEANT4. ]{Electron (a) and positron (b) light output from simulation compared to a GEANT4 step 2$^\textrm{nd}$ order polynomial approximation + Birks' law when dE/dx > 2 MeV/mm.}
\label{fig:square_electron_positron_light}
\end{figure}

In order to convert from energy deposition to light yield, the scintillator's response to electrons needs to be considered. The light produced by an electron is the highest amount of light per MeV that a particle can produce. This MeV electron equivalent (MeVee) is a special nomenclature used to describe the absolute light yield \cite{knoll_2010}. The light emission can be described by equation \ref{equ:lightSquaedFunc} as seen in figures \ref{subFig:electron_light} and \ref{subFig:square_electron_light} which can then be used to convert between light and energy. Equation \ref{equ:MeV_electron_equivalent_square} shows the values for the $L^2$ fit in \ref{subFig:electron_light} and \ref{subFig:square_electron_light}. The $E^2$ coefficient is much smaller than the coefficient for E and as a result the fit was changed to a linear fit, the values for which are shown in equation \ref{equ:MeV_electron_equivalent_linear} ($\chi^2$/NDF = 9.01531). Equation \ref{equ:MeV_electron_equivalent_linear} is then differentiated to obtain $dL/dE$ in equation \ref{equ:MeV_electron_equivalent_dl/de} which is then rearranged so that light output can be converted into energy in equation \ref{equ:MevLightConversion}. As mentioned earlier, the approximation made is that $\Delta E \sim dE$ and $\Delta L \sim dL$, where the $\Delta L$ is the light produced in the GEANT4 step and $\Delta E$ is the energy produced in the step according to that light output. Therefore, the approximated light produced can now be converted to energy.
\begin{equation}
    L = aE^2 + bE +c
    \label{equ:lightSquaedFunc}
\end{equation}
\begin{equation}
L = 0.0876519E^2 + 10396.7E - 263.7
\label{equ:MeV_electron_equivalent_square}
\end{equation}
\begin{equation}
L = 10401.2E - 281.307
\label{equ:MeV_electron_equivalent_linear}
\end{equation}
\begin{equation}
\frac{dL}{dE} = 10401.2
\label{equ:MeV_electron_equivalent_dl/de}
\end{equation}
\begin{equation}
dE = \frac{dL}{10401.2} \sim \Delta E = \frac{\Delta L}{10401.2}
\label{equ:MevLightConversion}
\end{equation}

% \\\\The conversion of light into energy for electrons (figure \ref{subFig:square_electron_light}) is defined by equation \ref{equ:MeV_electron_equivalent_square}. The light of an electron is the highest amount of light per MeV that a particle can deposit this MeV electron equivalent (MeVee) is a special nomenclature used to describe the absolute light yield \cite{knoll_2010}. In equation \ref{equ:MeV_electron_equivalent_square} the squared term is $ << $ than the linear term, therefore the squared term is ignored for the purposes of light conversion, producing equation \ref{equ:MeV_electron_equivalent_linear}. By rearranging equation \ref{equ:MeV_electron_equivalent_linear} for energy production equation \ref{equ:MeV_electron_equivalent_light} is produced. The same is done for the $e^+$ producing equation \ref{equ:MeV_postirtron_equivalent_light} . A small value of 0.1 is present in equations \ref{equ:MeV_electron_equivalent_linear}, \ref{equ:MeV_electron_equivalent_square}, \ref{equ:MeV_electron_equivalent_light}, \ref{equ:MeV_postirtron_equivalent_light} this is to prevent negative energy values from being produced in equation \ref{equ:MeV_electron_equivalent_light}.  The reason the light yield is so different for $e^-$ and $e^+$ is due to the quenching effect being combined with the straggling effect. Range straggling is caused when particles have differing track lengths inside the scintillator thus depositing differing amounts of energy. These variable track lengths for $e^-$ and $e^+$ are due mostly to their small mass, for heavy charged particles such as protons or $\alpha$s the straggling amounts to a few percent of the mean range\cite{knoll_2010}. Hence $e^-$ and $e^+$ require a different light model to other charged particles.
% \begin{equation}
% L = 0.9347E^2 + 10340E - 0.1000
% \label{equ:MeV_electron_equivalent_square}
% \end{equation}
% \begin{equation}
% L = 10340E - 0.1000
% \label{equ:MeV_electron_equivalent_linear}
% \end{equation}
% \begin{equation}
% E = \frac{L +0.1000}{10340} 
% \label{equ:MeV_electron_equivalent_light}
% \end{equation}
% \begin{equation}
% E = \frac{L +0.1000}{10347.1}
% \label{equ:MeV_postirtron_equivalent_light}
% \end{equation}

\section{Loss of Visible Energy due to Quenching}\label{sec:GEANT4Simulation_quenchingLoss}
Now the light has been suitably approximated from GEANT4, an investigation into the visible energy loss via quenching is required. Scintillator can only produce so much light for a given volume, this light saturation is a function of both energy and mass and is covered in section \ref{sec:GEANT4Simulation_ModellingLightEmission}. It is the ratio of ``damaged'' to ``undamaged '' particles \cite{craun_1970} described by Birks' law (equation \ref{equ:Birks_formula}) \cite{knoll_2010}. By considering five example particles and their corresponding anti-particles, the scale of the quenching in the VIDARR detector can be observed. The first particles to be considered were electrons. They are a common source of background and have a large charge to mass ratio when compared to other particles. The particles were simulated using a ``slab'' of material (figure \ref{fig:electrons_viewed_in_slab}) instead of using a bar or a full detector simulation. This was done to ensure that the energy deposition was fully contained within the scintillation medium so that the full visible energy loss due to quenching could be measured. The effect of quenching was negligible for electrons and positrons (figure \ref{fig:electron_positron_quenched_and_not}) but there is a slight overshoot > 7\,MeV. This does suggest there is a $\sim 1\,\%$ error in approximating GEANT4's light output above 7\,MeV. This is likely due to the approximation $\Delta L \sim dL$ and $\Delta E \sim dE$  being less accurate above 7\,MeV and was the main reason the light fits had to be constrained up to 100\,MeV, to characterise the scintillator light response as accurately as possible. 

\begin{figure}[!h]
\centering
\begin{subfigure}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/quenchedElectronsNew.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:electron_quenched_and_not}
\end{subfigure}%
\begin{subfigure}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/quenchedPositronsNew.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:positron_quenched_and_not}
\end{subfigure}
\caption[Electron and positron visible energy in a slab of scintillator.]{Electrons (a) and positrons (b) visible energy with and without quenching in a ``slab'' of material (see figure \ref{fig:electrons_viewed_in_slab}). Quenching has minimal effect on either. }
\label{fig:electron_positron_quenched_and_not}
\end{figure}

%The effect of quenching on protons is much more significant than for electrons, the charge for protons is equal and opposite to electrons but the mass is $\sim$ 2000 times greater. This results in a large amount of energy no longer being deposited in the scintillator. As the tracks are shorter but the kinetic energy still needs to be deposited resulting in larger larger $dE/dx$ values and thus more quenching as there are more ``damaged'' particles in the track. The energy deposition for both protons (see figure \ref{subFig:proton_quenched_and_not}) and anti-protons (see figure \ref{subFig:Aproton_quenched_and_not}) is linear without quenching showing that for protons and anti-protons the effect of quenching is significant. For $\alpha$ particles the effect is even more significant $\alpha$ particles which are 4 times more massive than protons but have twice the charge (see figure \ref{fig:proton_Apronton_quenched_and_not}). 

Due to the high charge to mass ratio of electrons and positrons ($\sim 2000$ times higher than protons) the energy deposited in the ``slab'' of scintillator in figure \ref{fig:electron_positron_quenched_and_not} is surprisingly non-linear. This stands in stark contrast to the highly linear light yield (figures \ref{fig:electron_positron_light} and \ref{fig:square_electron_positron_light}). The reason is the scattering that electrons and positrons undergo whilst they travel through the scintillator. Higher energy electrons and positrons will scatter inelastically, losing energy with each scatter, as a result the energy response becomes less linear with higher energy. Electrons and positrons are also more susceptible to straggling than other particles but how much of the non-linear response is due to scattering and how much is due to straggling is difficult to discern. This behaviour appears to be unique to electrons and positrons, in figure \ref{fig:proton_Apronton_quenched_and_not} the response of other simulated particles shows that before quenching their response is linear. 
\\\\Unlike electrons and positrons the effect of quenching on the other particles and anti-particles is vastly more significant than scattering and straggling. Figure \ref{fig:proton_Apronton_quenched_and_not} shows that the energy visible\footnote{Visible energy is defined as the maximum amount of energy the scintillator can produce in a given GEANT4 step given the quenching} is almost unaffected through scattering and straggling for the other particles, but the effect of quenching is significant. This is due to the shorter travel distance that more massive particles traverse. A shorter distance leads to more ``damaged'' particles over a smaller area and thus more quenching. The effect is especially pronounced for protons and alpha particles. The light loss due to quenching for protons varies from $\sim$ 90\,\% at a generated energy of 1\,MeV to $\sim$ 50\,\% at a generated energy of 10\,MeV (see figure \ref{fig:proton_Apronton_quenched_and_not}). But the effect for alpha particles is even more significant with almost none of the energy being visible below 1\,MeV and only $\sim$ 10\,\% of energy visible at 10\,MeV (see figure (\ref{fig:proton_Apronton_quenched_and_not})). This is the primary reason why simulating particles heavier than alpha particles is not done for VIDARR. Particles more massive than alpha particles will be quenched to such a point that they are unlikely to deposit a noticeable amount of visible energy in the detector's scintillator. 

\begin{figure}[!h]
\centering
\begin{subfigure}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/particleQuenchingComparisonRedo.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:proton_quenched_and_not}
\end{subfigure}%
\begin{subfigure}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/aParticleQuenchingComparisonRedo.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:Aproton_quenched_and_not}
\end{subfigure}
\caption[Particle and anti-particle visible energy in a slab of scintillator.]{Particles (a) and anti-particles (b) visible energy with and without quenching in a ``slab'' of material (see figure \ref{fig:electrons_viewed_in_slab}). The effect of quenching scales with the mass of the simulated particles.}
\label{fig:proton_Apronton_quenched_and_not}
\end{figure}

% \begin{figure}[!h]
% \centering
% \begin{subfigure}{.45\textwidth}
%   \centering
%   \includegraphics[width=\linewidth]{Chapter4/Figs/newQuenchPlots/alphaBirksSlab_quenchingComparison.png}
%   \captionsetup{width=.9\linewidth}
%   \caption{}
%   \label{subFig:alpha_quenched_and_not}
% \end{subfigure}%
% \begin{subfigure}{.45\textwidth}
%   \centering
%   \includegraphics[width=\linewidth]{Chapter4/Figs/newQuenchPlots/aAlphaBirksSlab_quenchingComparison.png}
%   \captionsetup{width=.9\linewidth}
%   \caption{}
%   \label{subFig:Aalpha_quenched_and_not}
% \end{subfigure}
% \caption{$\alpha$ (a) and $\bar{\alpha}$ (b) particles visible energy with and without quenching in a ``slab'' of material (see figure \ref{fig:electrons_viewed_in_slab}).}
% \label{fig:alpha_Aalpha_quenched_and_not}
% \end{figure}



%\section{Modelling The Bar}
\section{Characterising Measured Scintillation Light}
\subsection{Modelling Attenuation}\label{sec:GEANT4Simulation_ModellingAttenuation}
The GEANT4 simulations of light creation in the scintillator does not include the light collection and sensor efficiencies. The polystyrene into which the scintillator dopants are
added attenuates light with an attenuation length of $\sim$ 7\,cm requiring a fibre to be thread requiring a fibre in the centre of each bar to act as a light guide. This fibre wavelength shifts the light again to better match the efficiency profile of the photosensors (the MPPCs). The proportion of light guided into the fibre directly or via reflections upon the TiO$_2$ coating of the bars is expected to be mostly constant as the mean path of scintillation light to reach the fibre is not strongly dependent on initial position relative to the fibre. The light is attenuated slightly in the fibre before reaching the photosensors and this is described by an attenuation length (amount of bar traversed to lose $\sim$ 63\,\%  of light) so that the number of photons measured by the photosensor may be described as
\begin{equation}
    \textrm{N(PE)} = \textrm{N$_{\textrm{scint}}$} \times \textrm{P$_\textrm{f}$} \times \exp{ \left( \frac{x}{\lambda} \right) } \times \epsilon\textrm{$_{\textrm{sensor}}$}
\label{equ:nPeScint}
\end{equation}
where N(PE) is the number of photons measured, N$_{\textrm{scint}}$ is the number of scintillation photons produced, P$_\textrm{f}$ is the proportion of scintillation photons captured by the fibre, $x$ is the distance along the bar between the photosensor and the incident light and $\lambda$ is the attenuation length of the fibre. $\epsilon_{\textrm{sensor}}$ is the product of the photocoupling efficiency of the fibre and the photosensor and the photosensor efficiency. These factors may be combined into a calibration constant, in the regime where N$_{\textrm{scint}}$ is proportional to energy deposit so that equation \ref{equ:nPeScint} becomes
\begin{equation}
     \textrm{N(PE)} = C \times \exp{ \left( \frac{x}{\lambda} \right) } \times E 
 \label{equ:nPeScint2}
 \end{equation}
where $C$ and $\lambda$ may be determined empirically.
\\\\To determine the calibration constant and fibre attenuation length, a test stand was set up by fellow collaborator George Holt. This test stand contained a single scintillating bar with a wavelength shifting fibre threaded though the middle attached to a MPPC sensor. To increase light yield at the sensor, the end of the fibre was mirrored by painting with TiO$_2$. A $^{137}$Cs test source was place onto of the bar at eleven intervals along it's length. The gamma-rays from the source produce electrons via Compton scattering within the scintillator with the photo-sensor signal dependent on the energy deposit and the fibre attenuation. The mean number of photo-electrons (PE) measured by the sensor for each source position is shown in figure \ref{fig:attenuationPlot}. The data was fitted to equation \ref{equ:nPeScint2} using MINUIT2 in ROOT\cite{ROOT_Brun_1997} giving an attenuation length of 580 $\pm$ 60\,cm. The mean photo-electron  yield extrapolated to 0\,cm is 13.1 $\pm$ 0.2\,PE for Compton scattered $^{137}$Cs gamma-rays. Other test sources were used to determine the expected photon yield per MeV for gamma-rays, giving a value of 25\,PE/MeV. The attenuation length is similar to the measured values by the T2K ECAL detector 3.9 -- 4.1\,m \cite{Allan_2013}, with the higher measured attenuation length potentially due to the mirroring at the end.

%This test stand contained a single plastic scintillating bar where a $^{137}$Cs source was placed at 11 intervals across the bar from which attenuation of the 662\,keV peak could be measured. This is shown in figure \ref{fig:attenuationPlot} the exponential function (equation \ref{equ:attenuationFunction}) is used by the simulation to produce a data-driven model for the light attenuation in the simulation. The initial intensity is defined to be 13.1 $\pm$ 0.2\,PE by the Minuit2 fit with an attenuation length of 580 $\pm$ 60\,PE/cm and a $\chi^2$/NDF = 1.22. This should provide an accurate model for the attenuation within the bars of the VIDARR detector as it uses the same scintillator MPPC combination found in the VIDARR detector. At present no other experiments have this specific combination of scintillator shape, size and MPPC version so using these values should be more accurate than using values from the literature. George Holt measured the Compton scattering from the 662\,KeV gamma-ray and determined the number of PE per MeV to be 25\,PE for 1 MeV.
% \begin{equation}
% P(x) = e^{-x/\lambda}
% \label{equ:attenuationFunction}
% \end{equation}

\begin{figure}[!h]
 \centering
 \includegraphics[width=0.6\linewidth]{Chapter4/attenuation_plot_no_box.png} 
 \captionof{figure}[Attenuation plot from a single bar test stand.]{The attenuation plot from the single bar test stand produced by George Holt. The attenuation length (amount of bar traversed to lose $\sim$ 63\,\%  of light, $\lambda$ in equations \ref{equ:nPeScint} and \ref{equ:nPeScint2}) is 580 $\pm$ 60\,PE/cm. The initial intensity is 13.1 $\pm$ 0.2\,PE. $\chi^2$/NDF = 1.22.} 
 \label{fig:attenuationPlot}
\end{figure}

The data from the test stand was gathered by George Holt in January of 2019 from an old T2K bar. These bars comprise the bottom 49 layers of the VIDARR detector and were the entirety of the prototype. As such, the ageing of the scintillator bars up to January 2019 is already considered by the simulation. The T2K collaboration has performed a study on scintillator ageing which has the same characteristics a the VIDARR scintillator (1\%~PPO + 0.3\,\%~POPOP polystyrene scintillator). The light yield was found to degrade by 1.2--2.2\,\% \cite{t2k_scintillatorAging2022}, which was consistent with the MINOS collaboration's result of $\sim$~2\,\% \cite{t2k_scintillatorAging2022} \cite{minosAging2008}\footnote{It is noted that the MINER$\nu$A found a 7.5\,\% drop in light yield per annum, but this result is currently considered inconsistent with the MINOS and T2K results\cite{t2k_scintillatorAging2022} }. This means that the PE values stated further on in this thesis maybe 4.2\,\%--7.7\,\% lower than when the detector is first commissioned. However, the top 21 layers of the VIDARR detector will produce $\sim$~7.8--14.3\,\% more light than simulated (assuming the T2K bars were produced in 2009). A light yield decrease of 4.2\,\%--7.7\,\% will not majorly effect the threshold for the work later presented here. Although, once the VIDARR detector is commissioned cosmic muon data will be used to calibrate each channel individually. 

\subsection{Modelling MPPC Response}\label{sec:GEANT4Simulation_ModellingDarkNoise}
Upon generation of a photo-electron in a pixel of a MPPC, a fast pulse of $\sim 3 \times 10^6$ Geiger avalanche electrons are produced. Additionally, each pixel may after-pulse, triggering another avalanche  whilst recovering
from the Geiger discharge giving up to $\sim 3 \times 10^6$ electrons (full avalanche)  of additional charge or cross-talk, producing a Geiger discharge in a neighbouring pixel. This Geiger discharge due to cross-talk may in turn cause further cross-talk or after-pulsing. The probability of after-pulsing is $\sim 30 \%$ and the probability of a single cross-talk is $\sim 3 \%$ for these sensors. The charge spectrum produced by a MPPC from a single photo-electron is therefore complex due to after-pulsing and cross-talk. It is measured using the dark noise of the MPPC where thermal excitations cause the first electron to start a Geiger discharge.
\\\\Another data-driven physical effect modelled in the simulation is the dark noise. Depending on temperature MPPCs will emit signals that are due to electronic effects rather than light measurements. The dark noise was measured at room temperature using a charge sensitive pre-amplifier and shaper amplifier connected to an oscilloscope  over a 12 hour period by George Holt. A small part of the pedestal peak (akin to the zero value for the MPPC) may be seen, truncated by the trigger threshold on the oscilloscope. The results in figure \ref{fig:pureDarkNoise} show Photo-electron-equivalent (PEE) peaks in units of mV with peaks for 1\,PE, 2\,PE and 3\,PE being clearly visible at 4.1\,mV, 8.2\,mV, and 12.3\,mV respectively. 
\begin{figure}[!h]
 \centering
 \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/pureDarkNoise_outputMedText.png}
 \captionof{figure}[Dark noise from an MPPC taken over a period of 12\,hours.]{Dark Noise from the MPPC taken over a period of $\sim$ 12\,hrs, taken by George Holt. The PE peaks for 1\,PE 2\,PE and 3\,PE can be seen at 4.1\,mV, 8.2\,mV and 12.3\,mV respectively. } 
 \label{fig:pureDarkNoise}
\end{figure}
% The dark noise has two distinct components: the peaks, and the  after-pulsing background surrounding the peaks. The background surrounding the peaks can be modelled using an exponential fit which is done in figure \ref{subFig:expFitOfDark}. In addition to the PE peaks and exponential noise there is also a pedestal peak (seen at 3\,mV in figure \ref{fig:pureDarkNoise}). This is the zero value for the MPPC and as such is discounted it's not relevant for measuring PE peaks which is what the analysis focuses on. The pedestal is useful for determining the gain and for calibration of channels but this is not the focus of the simulation which explicitly tries to emulate a believable signal post calibration. The removal of the pedestal peak and use of the aforementioned exponential fit is done in figure \ref{subFig:fittedDarkNoise}.
\\The data at high voltages has low statistics so to model this an exponential function was used. Gating around the PEE peaks, data was selected and fitted to an exponential, the data and the fit are shown in figure \ref{fig:fitting_of_non_peak_dark_noise}. To produce a spectrum for use in Monte-Carlo, data from the measurement without the pedestal was used up to 13.7\,mV, beyond 13.7\,mV the fitted exponential was used. This spectrum was then converted into a cumulative probability distribution shown in figure \ref{fig:cumulative_prob_dark}. A voltage spectrum recreated from this distribution is shown in fig \ref{fig:cumulative_prob_dark}. To simulate the voltage generated by the number of PE in a bar, the cumulative probability distribution is used to generate a voltage value for each PE and these are added together to give the total voltage. Dark noise is simulated with a noise frequency of 15,000\,Hz\footnote{These numbers for the dark noise originate from a study on the MPPCs used by VIDARR done by a masters student in 2017.} assuming an event window of 100\,$\mathrm{\mu}$s for inverse beta decay and a noise window of 100\,ns. These approximations were also data driven and the results are represented in figure \ref{fig:individualDarkNoiseOld}.
%The pedestal peak (seen at 3\,mV in figure \ref{fig:pureDarkNoise}) is also removed and an exponential is used past 13.7\,mV (see figure \ref{subFig:fittedDarkNoise}). 
\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/fit_of_dark_noiseMedText.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:expFitOfDark}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/fittedDarkNoise_outputMedText.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:fittedDarkNoise}
\end{subfigure}
\caption[Dark noise from an MPPC with an exponential fitted to the tail.]{Dark noise from an MPPC taken over a period of $\sim$ 12\,hrs with an exponential fitted, with a $\chi ^2$ /DOF = 159.748. In (a) the fit of exponential function uses MINUIT2 to fit the after-pulsing of the MPPCs. The exponential fit is used past 13.7\,mV when the count rate drops below 10 and the conjoined distribution can be seen in (b).}
\label{fig:fitting_of_non_peak_dark_noise}
\end{figure}

% The results from figure \ref{fig:fitting_of_non_peak_dark_noise} can then be used to construct a cumulative probability distribution seen in figure \ref{fig:cumulative_prob_dark}. This probability distribution is what the simulation reads to reconstruct the dark noise distribution. During the simulation, a random dice is thrown and that probability is then converted back into a dark noise value which is then assigned to a random bar in the detector. Values past 13.7\,mV use the exponential fit. These events extrapolate directly from the exponential fit instead of reading from the probability distribution for more realistic results. The dark noise produced for a full detector over 10$^6$ events is shown in figure \ref{fig:individualDarkNoiseOld}. 

\begin{figure}[!h]
\centering
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/cumulative_prob_dark_noiseMedText.png}
  \captionof{figure}[Cumulative probability of MPPC dark noise.]{Cumulative probability of the dark noise, which is converted to a table and then searched using the golden section search} 
  \label{fig:cumulative_prob_dark}
  \vspace{0.956cm} %1 line = 0.478cm % 2 lines = 0.956cm % 3 lines= 1.434cm % 4 lines = 1.912cm % 5 lines = 2.39cm
\end{minipage}%
\qquad
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/darkNoiseLogMedText.png} 
  \captionof{figure}[Generated dark noise for the upgraded 2660 barred VIDARR detector.]{Generated dark noise for the upgraded 2660 barred VIDARR detector with 10$^6$ events resulting in $\sim$ 3E6 dark noise hits. The exponential tail fit shown in figure \ref{fig:fitting_of_non_peak_dark_noise} has seamlessly connected to the rest of the distribution.}
  \label{fig:individualDarkNoiseOld}
\end{minipage}
\end{figure}

\subsection{Modelling TiO$_2$ Coating}
The plastic scintillating bars of the VIDARR detector were extruded at Fermilab and have been used in other experiments such as the T2K ND280 ECal \cite{Allan_2013} Miner$\nu$a \cite{aliaga2014design} and in Mu2e as a cosmic ray veto \cite{Pla-Dalmau2014}. By simulating particles at the edge of a single bar, as shown in figure \ref{fig:lengthAndSideViewBarMuon}, the actual energy deposited in the bar can be observed in the simulation. The impact that the TiO$_2$ coating has on the energy deposited in the bars depends on two variables, the mass of the particle and the energy of the particle. When generating electrons and protons between 0\,MeV -- 20\,MeV (figure \ref{fig:muonProton_TiO2}) the impact of both of these variables becomes clear. In figure \ref{fig:muonProton_TiO2} the TiO$_2$ coating is set to a thickness of 0.25\,mm which is the thickness Fermilab extrudes the coating \cite{Pla-Dalmau2014}.

\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/year1Plots/lengthOnViewBarMuon1530By720.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:lengthOnViewBarMuon1530Square}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/sideOnViewBarMuon1530By720.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:sideOnViewBarMuon8}
\end{subfigure}
\caption[A 20\,MeV muon particle penetrating a single bar.]{How a 20\,MeV muon particle penetrates through the coating and scintillator it is offset to ensure the effect from the TiO$_2$ coating is being correctly observed. The top down view (x,y) is shown in (a). The side on view (x,z) is shown in (b).}
\label{fig:lengthAndSideViewBarMuon}
\end{figure}


\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/electronEdepTiO2Coating.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:proton_TiO2}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/protonsEdepTiO2Coating.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:muon_TiO2}
\end{subfigure}
\caption[Energy deposition for electrons and protons in a TiO$_2$ coated bar.]{(a) The average energy deposited for generated electrons deposited in a single bar of scintillator, the percentage of TiO$_2$ has no significant impact. (b) The average energy deposited for generated protons deposited in a single bar of scintillator, the percentage of TiO$_2$ coating has significant impact at lower energies.}
\label{fig:muonProton_TiO2}
\end{figure}

%The TiO$_2$ coating is 15\,\% TiO$_2$ to 85\,\% polythene \cite{aliaga2014design} \cite{Pla-Dalmau2014} with a thickness of 0.25\,mm \cite{Pla-Dalmau2014}. The correct amount of TiO$_2$ is now correctly implemented in the simulation for each of the 2660 bars in VIDARR. 

The percentage of TiO$_2$ to polythene is 15\,\% TiO$_2$:85\,\% polythene \cite{aliaga2014design} \cite{Pla-Dalmau2014}. The simulated TiO$_2$ coating reflects this and is varied from 0\,\% -- 60\,\% in figure \ref{fig:muonProton_TiO2} to show the impact TiO$_2$ has on the electrons and protons. The impact on electron energy deposition is insignificant but the TiO$_2$ coating has a large impact on protons from 0\,MeV -- 10\,MeV. At low energies (0\,MeV -- 5\,MeV) protons don't penetrate very far and are unable to get through the 0.25\,mm coating regardless of composition. The percentage of TiO$_2$ also has an impact but it is less than than having a coating present at all. The energy deposited by protons is always lower for the 0 -- 20\,MeV range. This is important as it shows how unlikely it is that low energy protons and alpha particles are to penetrate the TiO$_2$ coating. In particular, protons below 5\,MeV are unlikely to escape a single bar with a TiO$_2$ of 15\,\%. As single bar events in the VIDARR detector are usually rejected by selection criteria it appears the TiO$_2$ coating will significantly reduce the number of proton and alpha particle events that will be considered as signal thus improving the signal to noise ratio. 

\section{Counting Statistics} \label{sec:GEANT4Simulation_countingStats}
As the number of PE measured by the MPPCs $\sim$ 25 per MeV, there will be a significant variation due to counting statistics. For small energy deposits this is best characterised by Poisson statistics. \ref{equ:possionProb} \cite{knoll_2010}.
\begin{equation}
P(x) = \frac{(pn)^x e^{-pn}}{x!}  
\label{equ:possionProb}
\end{equation}
% When a particle passes through the scintillating medium it produces photons as it interacts with the medium. These photons then travel through the bar until they meet the WLS fibres. The photons then travel down the WLS fibres until they encounter the MPPC this signal is then amplified by the MPPC producing a signal of 4.2\,mV per photon (in most cases) which is equivalent to one photon see figure \ref{fig:pureDarkNoise} which is called a photo-electron equivalent (PE). So for $n$ number of PE, there will be a Poisson distribution (equation \ref{equ:possionProb}) due to counting statistics. %Poission statistics 
A Poisson approximation is suitable because there is a small probability of a given outcome in this case. For this distribution $pn = \overline{x}$, where $\overline{x}$ is the expectation value, substituting this into equation \ref{equ:possionProb} we get equation: 
\begin{equation}
P(x) = \frac{(\overline{x})^x e^{-\overline{x}}}{x!}  
\label{equ:possionExpectation}
\end{equation}

Further, the variance of this model can be explained using equation  \ref{equ:possionVar} which also has $\sigma^2 = \overline{x}$ giving a standard deviation of $\sigma = \sqrt{\overline{x}}$ \cite{knoll_2010}. This definition of the standard deviation is also true for the Gaussian distribution. The Gaussian distribution using this standard deviation can be seen in equation \ref{equ:guassianExpectation}. When $n$ is high enough, the Poisson distribution will approximate Gaussian distribution. This is useful when simulating photon counting statistics because a Gaussian distribution is much less computationally intensive as there is no factorial term. The tolerated deviation for this was set to 99.9\,\% of the event in the Poisson distribution being above two events or more, this occurs at a mean of 10 photons. Above a mean of ten photons the Gaussian distribution is used instead. The distribution for ten photons can be seen in figure \ref{fig:CoutingStats10}, a slight skew in the Poisson is visible but the distributions approximate.
% The point where Gaussian is used instead of Poisson in the simulation is at a value of 10 photons seen in figure \ref{fig:CoutingStats10}. At an expectation value of 10 photons 99.9\,\% of events produced have $>$ 2 photons in the Poisson distribution (see figure \ref{fig:CoutingStats10}). This is a useful limit to switch distributions as it ensures that the low values of PE correctly modelled by the Poisson distribution are minimal. 

\begin{equation}
\sigma ^2 \equiv \sum_{x=0}^{n} (x-\overline{x})^2 P(x) = pn = \overline{x} 
\label{equ:possionVar}
\end{equation}

\begin{equation}
P(x) = \frac{1}{\sigma \sqrt[]{2 \pi}} \exp \left(-\frac{1}{2}\left(\frac{x-\overline{x}}{\sigma}\right)^{2}\right)
\label{equ:guassianExpectation}
\end{equation}

\begin{figure}[!h]
 \centering
 \includegraphics[width=0.7\linewidth]{Chapter4/Figs/poissionGaussian10Graph.png}
 \captionof{figure}[Counting statistics for Poisson and normal distribution.]{Counting statistics for Poisson and normal distribution for an expectation value of 10 photons the normal distribution is used when the expectation value is $\geq$ 10 photons to save on computational load.} 
 \label{fig:CoutingStats10}
\end{figure}

\section{Combined Simulation of Detector Components}\label{sec:GEANT4Simulation_resultsPhysicalElectronics}
With the full detector simulation for non-neutrons implemented it is now important to test how these elements influence the expected energy deposited in the detector. The effect of quenching are more significant for the heavier charged particles, protons, alphas, and their corresponding anti-particles (see section \ref{sec:GEANT4Simulation_quenchingLoss}). The heaviest particle expected to be seen in statistically significant quantifies is the alpha particle. Therefore, the alpha particle represents the largest deviation from the naive assumption that the detector signal is directly proportional to the energy deposited in the scintillator and the more realistic expected detector signal. For this reason, alpha particles are used to assess the impact of the more realistic simulation.  
\\\\If these effects are ignored in the simulation then the results look nonphysical. In figure \ref{fig:alpha_summed_vs_truth} the summed visible energy inside the detector is equal to the generated energy in most cases. This is because the additional effects are being ignored and only the energy deposited in the scintillator is being used for reconstruction. The only events which do not have all the energy summed in the detector are those which were generated near the edges of the bar, these events are absorbed by the TiO$_2$ coating and so deposit less energy in the active parts of the detector. The modelling of quenching (see section \ref{sec:GEANT4Simulation_MonteCarloBirksLaw}) and attenuation (see section \ref{sec:GEANT4Simulation_ModellingAttenuation}) therefore cause a large decrease in the visible summed energy inside the detector (figure \ref{fig:alphaVisVsTruthZoom}). Figure \ref{fig:alphaVisVsTruthZoom} is an idealistic representation of what alpha particles would look like in a VIDARR detector with perfect electronics exhibiting no losses or biases from the counting statistics (see section \ref{sec:GEANT4Simulation_countingStats}) or biasing by the MPPC PE smearing (see section \ref{sec:GEANT4Simulation_ModellingDarkNoise}). Finally, the effects caused by the electronics (figure \ref{fig:fitting_of_non_peak_dark_noise}) and the counting statistics (figure \ref{fig:CoutingStats10}) give the simulated distribution a more realistic shape (figure \ref{fig:alphaRecoVsTruthZoom}). The distinct differences shown in figures \ref{fig:alpha_summed_vs_truth}, \ref{fig:alphaVisVsTruthZoom}, \ref{fig:alphaRecoVsTruthZoom} show the importance of quantifying each detector component and effect on the measurement. Especially background from heavy particles such as with proton and alpha particles. %With the data-driven approximations of the effects taken into account, the simulation should give a more realistic result. Unfortunately, due to the outbreak of COVID-19, the detector construction was delayed and so the accuracy of the simulation cannot be bench-marked against detector data. 


\begin{figure}[!h]
\centering
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/truth_vs_summed_alphaMedTextNew.png}
  \captionof{figure}[Raw alpha particle energy deposition into VIDARR detector.]{The energy deposited in a simulated detector by alpha particles without physical and electronic effects taken into account, this is the maximum possible energy that can be deposited. PE is expected PE assuming 25\,PE = 1\,MeV.} 
  \label{fig:alpha_summed_vs_truth}
  %\vspace{0.478cm} %1 line = 0.478cm % 2 lines = 0.956cm % 3 lines= 1.434cm % 4 lines = 1.912cm % 5 lines = 2.39cm
\end{minipage}%
\qquad
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/truth_vs_visSummed_alpha_zoomMedTextNew.png} 
  \captionof{figure}[Alpha particle deposited energy with physical detector effects.]{The energy deposited in a simulated detector by alpha particles when the physical effects of quenching and attenuation are taken into account. But the MPPC response and counting statistics are not taken into account. PE is expected PE assuming 25\,PE = 1\,MeV.}
  \label{fig:alphaVisVsTruthZoom}
\end{minipage}
\end{figure}

\begin{figure}[!h]
 \centering
 \includegraphics[width=0.5\linewidth]{Chapter4/Figs/Raster/truth_vs_recoSummed_alpha_zoomMedTextNew.png}
 \captionof{figure}[Reconstructed generated alpha particle energy with detector and electronic effects.]{The energy deposited in a simulated detector by alpha particles when the physical effects (quenching and attenuation) and the detector effects (MPPC response and counting statistics) are taken into account.} 
 \label{fig:alphaRecoVsTruthZoom}
\end{figure}

%white space
\vspace{2cm}

\section{Modelling Gadolinium}\label{sec:GEANT4Simulation_modellingGadolinium}
% Gd is used for a variety of reasons. Firstly natural Gd (which VIDARR utilises) has a cross-section of 48890\,b \cite{Abdushukurov_2010} with $^{157}$Gd and $^{155}$Gd having the largest cross-sections of 255000\,b and 61000\,b respectively \cite{Abdushukurov_2010}. To give an idea of how large these cross-sections are Gd 160 only has a cross section of 0.8\,b\cite{Abdushukurov_2010}. It also has much higher efficiency (10\,\% -- 40\,\%) compared with other neutron capture material such as $^6$Li which has $\sim$ 1\,\% \cite{Abdushukurov_2010}. The Gd sheets are also inactive components of the detector only significantly interacting with neutrons. Finally, and most importantly the Gd cascade released once a neutron has been absorbed has high multiplicity and often high energy. The only down side is that containing such a cascade requires a large $\sim$ tonne scale detector fortunately VIDARR is such a detector. 
Neutron capture on natural gadolinium is dominated by two isotopes, $^{155}$Gd with natural abundance of 14.7\,\% and thermal neutron absorption cross-section of 61,000\,b and $^{157}$Gd with natural abundance of 15.68\,\% and thermal neutron absorption cross-section of 255,000\,b \cite{Abdushukurov_2010}. A list of the most widespread isotopes of Gd including abundances and cross section can be seen in table \ref{tab:gdTable}. Both isotopes decay via a $\sim$ 8\,MeV gamma-ray cascade after neutron absorption. The gamma-ray cascades are very complex, measurements have shown that only a small percentage of the decays (6.8\,\% for $^{157}$Gd and 2.3\,\% for $^{155}$Gd) correspond to discrete transitions, with the rest thought to decay via continuum states \cite{jparc_gdProdNAbsorb_2016}. 
%Attempts have been made to measure the cascades and understand the energies and multiplicities of gamma-rays in each cascade. Measurements are difficult due to low containment the gamma-rays due to low photo-peak efficiencies ($\sim$ O(1\,\%)) \cite{jparc_gd157capture_2019}, research is ongoing to better understand these cascades.

\begin{table*}[!h]
\centering
\begin{tabular}{lcccc}  
\toprule
Isotope             & Abundance [\%] & Coss-section [b] & Daughter isotope & T 1/2      \\
\midrule
$^{\textrm{nat}}$Gd & 100            & 48890            & -                & -          \\
$^{152}$Gd          & 0.2            & 1100             & $^{153}$Gd       & 241.6\,d   \\
$^{154}$Gd          & 2.2            & 90               & $^{155}$Gd       & stable     \\
$^{155}$Gd          & 14.7           & 61000            & $^{156}$Gd       & stable     \\
$^{156}$Gd          & 20.6           & 2.0              & $^{157}$Gd       & stable     \\
$^{157}$Gd          & 15.68          & 255000           & $^{158}$Gd       & stable     \\
$^{158}$Gd          & 24.9           & 2.4              & $^{159}$Gd       & 18.6\,h    \\
$^{160}$Gd          & 21.9           & 0.8              & $^{161}$Gd       & 3.66\,min  \\
\bottomrule  
\end{tabular}
\caption{Abundance, cross-section interaction with neutrons, daughter isotopes, half-life period of unstable isotopes for the most widespread isotopes of Gd taken from \cite{Abdushukurov_2010}.}
\label{tab:gdTable}
\end{table*}

The 8\,MeV gamma-ray cascade post neutron capture is the trigger signal for the VIDARR detector. After the cascade activates the trigger, the detector looks backwards in time to record the positron cluster. The Gd cascade is difficult to measure and accurately simulate for two main reasons. Firstly the Gd isotopes which have a high neutron capture cross-section are isotopes $^{155}$Gd and $^{157}$Gd \cite{molnar_2004}. Both of these nuclei are large therefore it is difficult to accurately model the individual interactions between each of the individual nucleons. There is no agreed-upon model at present for the neutron absorption onto Gd and the subsequent 8\,MeV gamma cascade. The second issue is that the high energy gamma-rays emitted by the cascade are very difficult to contain as they are highly penetrative and have low photo-peak efficiencies ($\mathcal{O} \sim 1\,\%$) research is ongoing to better understand these cascades.  Therefore, getting accurate measurements and energy efficiencies for the cascade is also part of ongoing research. These two problems compound one another. It is difficult to measure the cascade so it is difficult to model thus making it difficult to know what energies are expected from the Gd nucleus \cite{molnar_2004}. 
%\\\\The gamma-ray cascades of Gd is simulated in GEANT4 by two models,
GEANT4 has two models for simulating the gamma-ray Gd cascades, the photon evaporation model seen in figure \ref{subFig:differentGEANT4Models_photonEvaporationGd} and the final state model seen in figure \ref{subFig:differentGEANT4Models_finalStateGd}. These two models have different strengths and weaknesses the photon evaporation model conserves energy by ``boiling off'' the known decay energies of Gd until there is no more energy left to disperse. This approach attempts to match the multiplicity of the Gd cascade but in so doing, the high energy gamma-rays that are the most indicative of the Gd cascade are not present. The other model in GEANT4 is the final state model which tries to match the spectrum of measured gamma-rays. However, by using this approach conservation of energy is violated as the sum of the individual gamma-rays may exceed the initial generated energy by $\sim$ 0.5\,MeV. The violation of the Q-value is in the low energy tail of events $\lessapprox$ 3\,MeV \cite{YuChen_2015}. Of the two models, the final state is preferred in the case of IBD. This is because the high energy gamma-rays only present in the final state model may be used to distinguish Gd cascades from background gamma-rays, therefore the number of bars hit in the simulated detector is more likely to be correct. %and the multiplicities given for these cascades are more likely to be correct.
%This is because the high energy gamma-rays that distinguish the Gd cascade from the background are present in the final state model and not the photon evaporation model. Also the gammas are more likely to have the correct topology. 

\begin{figure}[!h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/gadolinium/photonEvaporationGd.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:differentGEANT4Models_photonEvaporationGd}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/gadolinium/FinalStateGd.png}
  \captionsetup{width=.9\linewidth}
  \caption{}
  \label{subFig:differentGEANT4Models_finalStateGd}
\end{subfigure}
\caption[Individual gamma-rays from 2 different models Gd cascade models in GEANT4.]{Individual gamma-rays for two different models for Gd cascade in GEANT4. The photon evaporation model conserves energy but does not produce high energy gamma-rays see (a). The final state model produces high energy gamma-rays but breaks the conservation of energy to do so (see (b)). Both plots from \cite{YuChen_2015}.}
\label{fig:differentGEANT4Models}
\end{figure}

%I'm not sure how useful this plot is... Natural Gadolinium is mentioned later with more context
% \begin{figure}[!h]
%  \centering
%  \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/gadolinium/naturalGd.png}
%  \captionof{figure}{Natural Gadolinium gamma spectra from \cite{molnar_2004}} 
%  \label{fig:naturalGd.png}
% \end{figure}

However, whilst the final state model is preferable to the photon evaporation model there is another alternative from the DANCE collaboration which produced a DICEBOX model of $^{157}$Gd \cite{Chyzh_2011}. DANCE is a gamma-ray calorimeter consisting of 160 BaF$_2$ scintillation detectors. The multiplicities of the cascade in DICEBOX are counted as the number of clusters that are observed rather than the number of crystals that fire in order to give a more accurate multiplicity measurement due to the high noise rate observed in the detectors below 3\,MeV \cite{Chyzh_2011}. The shape of the spectrum at low integrated energies ($\lessapprox 3$\,MeV) is strongly influenced by the background from natural beta activity in the BaF$_2$ crystals, especially for low multiplicities \cite{Chyzh_2011}. Measuring the number of clusters should reduce the errors for low multiplicity according to DANCE \cite{Chyzh_2011}. Therefore, by mitigating the noise energies and false multiplicities caused by noise hits < 3\,MeV, the DANCE spectra should  be more accurate in its representation of $^{157}$Gd than GEANT4's final state model as its low energy tail will not break the Q-value \cite{YuChen_2015}. The breakdown for the multiplicity cascade can be seen in figure \ref{fig:gadoliniumMultipliciesBreakdownCascade} where both the gamma-ray and electron multiplicities are shown. Most of the multiplicities are driven by the gamma-rays but some electrons are produced unlike the models in GEANT4. 
\\\\The breakdown for all the energies for the DICEBOX package is shown in figure \ref{fig:gadoliniumEnergiesCascade} where most of the energies produced are gamma-rays. The dominance of the gamma-rays is not surprising when comparing DICEBOX to the photon evaporation and final state models in GEANT4 (figure \ref{fig:differentGEANT4Models}). The generated energies for all of the particles can be seen in figure \ref{fig:energyOfCascadeOfCascadeGd}, the overall shapes resembles the photon evaporation model. The energies and particle types from figure \ref{fig:gadoliniumEnergiesCascade} are used to generate each secondary particle from the cascade. The WATCHMAN collaboration created a method to integrate the DANCE DICEBOX into GEANT4 by intercepting the internal GEANT4 function calls and replace the 8\,MeV gamma-ray cascade with gamma-rays generated by the DANCE DICEBOX. This implementation was adopted by the VIDARR collaboration. In figure \ref{fig:energyOfCascadeOfCascadeGd} high energy gamma-rays are visible unlike in the photon evaporation model (figure \ref{subFig:differentGEANT4Models_photonEvaporationGd}). However, the DANCE DICEBOX model also conserves energy, which never exceeds 8\,MeV (figure \ref{fig:conservationOfCascadeGd}). This is in contrast to the final state model where the total generated energies do not match the summed energies of the particles produced. However, DICEBOX does produce less accurate gamma-ray topology.

\begin{figure}[!h]
\centering
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/gadolinium/gadoliniumEnergiesCascadeMedText.png}
  \captionof{figure}[Energies from the DANCE $^{157}$Gd  DICEBOX]{Energies from the DANCE DICEBOX based on the DANCE experimental data for $^{157}$Gd \cite{Chyzh_2011}.} 
  \label{fig:gadoliniumEnergiesCascade}
\end{minipage}%
\qquad
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/gadolinium/gadoliniumMultipliciesBreakdownCascadeMedText.png} 
  \captionof{figure}[Multiplicities from the DANCE $^{157}$Gd  DICEBOX]{Multiplicities from the DANCE DICEBOX based on the DANCE experimental data for $^{157}$Gd \cite{Chyzh_2011}. }
  \label{fig:gadoliniumMultipliciesBreakdownCascade}
\end{minipage}
\end{figure}

% \begin{figure}[!h]
%  \centering
%  \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/gadolinium/pe_vs_fs_models_summed.png}
%  \captionof{figure}{blah.} 
%  \label{fig:pe_vs_fs_models_summed}
% \end{figure}

\begin{figure}[!h]
\centering
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/gadolinium/energyOfCascadeOfCascadeGdMedText.png}
  \captionof{figure}[Individual energy of all particles from the DANCE $^{157}$Gd DICEBOX.]{Energy of all particles from the $^{157}$Gd DICEBOX based on the DANCE experiment \cite{Chyzh_2011} which is then worked into GEANT4 using an implementation created by the WATCHMAN collaboration which was then copied by the VIDARR collaboration.} 
  \label{fig:energyOfCascadeOfCascadeGd}
\end{minipage}%
\qquad
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/gadolinium/conservationOfCascadeGd.png} 
  \captionof{figure}[Summed energy of all particles from the DANCE $^{157}$Gd DICEBOX.]{The summed energy for DICEBOX Gd gamma-ray cascade. There is no violation of the conservation of energy 8\,MeV energy is generated and 8\,MeV is observed by the simulation.}
  \label{fig:conservationOfCascadeGd}
  \vspace{0.478cm} %1 line = 0.478cm % 2 lines = 0.956cm % 3 lines= 1.434cm % 4 lines = 1.912cm % 5 lines = 2.39cm
\end{minipage}
\end{figure}

The photon evaporation model and final state model were compared with the measured spectrum from natural Gd as well as $^{155}$Gd,$^{157}$Gd in figure \ref{fig:comparisonGd} \cite{YuChen_2015}. The high energy gamma-rays observed in the natural and specific isotopes of Gd are present in the final state model which reads from the database ENDF \cite{BROWN20181} and tries to replicate the final state of the neutron \cite{koiTatsumi_2006}. By taking figure \ref{fig:comparisonGd} and overlaying the DANCE/WATCHMAN DICEBOX (figure \ref{fig:comparisonAndDiceBoxGd}) the similarities between photon evaporation model and DICEBOX are clear but it extends to higher energies producing more higher energy gamma-ray. DICEBOX shown in figure \ref{fig:comparisonAndDiceBoxGd} only represents $^{157}$Gd. The DANCE DICEBOX was based on data measured from a sample that was  99.7\,\% $^{157}$Gd \cite{Chyzh_2011}. 

\begin{figure}[!h]
 \centering
 \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/gadolinium/comparisonGd.png}
 \captionof{figure}[Comparison of GEANT4 Gd cascade models to natural Gd and $^{155,157}$Gd.]{How the photon evaporation and final state models in GEANT 4 compare to the measured spectra for natural Gd and $^{155,157}$Gd. High energy gamma-rays are only present in the final state model.  * \cite{kandlakunta_2012} ** \cite{bollinger_1970} from \cite{YuChen_2015}.} 
 \label{fig:comparisonGd}
\end{figure}

\begin{figure}[!h]
 \centering
 \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/gadolinium/comparisonAndDiceBoxGd.png}
 \captionof{figure}[$^{157}$Gd DANCE DICEBOX compared to GEANT4 Gd cascade models and natural Gd and $^{155,157}$Gd.]{Figure \ref{fig:comparisonGd} \cite{YuChen_2015} but with DICEBOX individual gamma-rays for $^{157}$Gd from figure \ref{fig:energyOfCascadeOfCascadeGd} overlaid on top. DICEBOX has similar low energy gamma-rays to the photon evaporation model but has more high energy gamma-rays as would be expected of the Gd cascade. * \cite{kandlakunta_2012} ** \cite{bollinger_1970}.}
 \label{fig:comparisonAndDiceBoxGd}
\end{figure}

The energies of the gamma-rays produced by the simulation are shown in figure \ref{fig:gdCascadeVsAllGammas}. The Gd cascade is from a simulation of natural Gd which uses the DANCE/WATCHMAN DICEBOX implementation when $^{157}$Gd captures a neutron and uses the final state model when other isotopes of Gd capture a neutron. In figure \ref{fig:gdCascadeVsAllGammas} the majority of the gamma-rays produced are from the $^{157}$Gd DICEBOX final state model hybrid. However, there is also a significant peak caused by the neutron capture on hydrogen. The effect of adding DICEBOX to the final state model can be seen in figure \ref{fig:TotalGeneratedEnergyOfCascadeFinalStateDicebox}. Compared to the final state model the peaks in the DICEBOX-final state hybrid are much more pronounced with more energy being emitted overall. The focus on the high energy gamma-rays also means that more energy is deposited in the scintillator as well (figure \ref{fig:finalStateAndDiceBoxBarsDepositedEnergy}). This is very useful for the VIDARR simulation, not only is the DICEBOX-final state hybrid more realistic than the pure final state model it also shows that the trigger signal for the VIDARR detector is even more unique than originally expected. The hybrid model also results in more hit bars than the pure final state model (figure \ref{fig:numberOfBarsHitCascadeFinalStateDicebox}). Both of these advantages will be useful for separating out the trigger signal from the noise as will be shown in section \ref{sec:MachineLearningTrigger}.

\begin{figure}[!h]
\centering
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/gadolinium/gdCascadeVsAllGammasMedText.png}
  \captionof{figure}[Individual simulated gamma-ray energies in the VIDARR detector]{The individual gamma-rays seen in the simulated VIDARR detector from generated neutrons with 0.025\,eV kinetic energy. The majority of the distribution is dominated by Gd cascade but a small peak is caused by the hydrogen absorption of the neutron.} 
  \label{fig:gdCascadeVsAllGammas}
\end{minipage}%
\qquad
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/finalStateAndDiceBoxBarsGeneratedEnergyMedText.png} 
  \captionof{figure}[Total generated Gd cascade energy for final state model and the DANCE DICEBOX.]{Total generated energy of the cascade DICEBOX based on the DANCE detector data \cite{Chyzh_2011}. When replacing the $^{157}$Gd final state interaction with DICEBOX more energy is generated.}
  \label{fig:TotalGeneratedEnergyOfCascadeFinalStateDicebox}
  \vspace{0.478cm} %1 line = 0.478cm % 2 lines = 0.956cm % 3 lines= 1.434cm % 4 lines = 1.912cm % 5 lines = 2.39cm
\end{minipage}
\end{figure}

\begin{figure}[!h]
\centering
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/finalStateAndDiceBoxBarsDepositedEnergyMedText.png}
  \captionof{figure}[Total energy deposited for the Gd cascade for final state model and the DANCE DICEBOX.]{The total energy deposited in the simulated VIDARR detector when generating neutrons with 0.025\,eV. Slightly more energy is deposited by the final state + DICEBOX model. (0$^{th}$ bin for Final state No $^{157}$Gd goes up to 80000)} 
  \label{fig:finalStateAndDiceBoxBarsDepositedEnergy}
\end{minipage}%
\qquad
\begin{minipage}{.45\textwidth}
  \centering
  \includegraphics[width=\linewidth]{Chapter4/Figs/Raster/finalStateAndDiceBoxBarsHitMedText.png} 
  \captionof{figure}[Total numbers of bars hit for the Gd cascade energy for final state model and the DANCE DICEBOX.]{The number of bars hit in the simulated VIDARR detector for different Gd models when generating neutrons with 0.025\,eV. The final state model with DICEBOX $^{157}$Gd was chosen and hits slightly more bars.}
  \vspace{0.478cm} %1 line = 0.478cm % 2 lines = 0.956cm % 3 lines= 1.434cm % 4 lines = 1.912cm % 5 lines = 2.39cm
  \label{fig:numberOfBarsHitCascadeFinalStateDicebox}
\end{minipage}
\end{figure}

% \begin{figure}[!h]
%  \centering
%  \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/gadolinium/summedEnergyPastTriggerGdDicebox.png}
%  \captionof{figure}{} 
%  \label{fig:summedEnergyPastTriggerGdDicebox}
% \end{figure}

% \begin{figure}[!h]
%  \centering
%  \includegraphics[width=0.7\linewidth]{Chapter4/Figs/Raster/gadolinium/GeneratedEnergyPastTriggerGdDicebox.png}
%  \captionof{figure}{} 
%  \label{fig:GeneratedEnergyPastTriggerGdDicebox}
% \end{figure}

%*******************************************************************************
%***************************************  End  *********************************
%*******************************************************************************